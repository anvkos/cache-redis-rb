# Cache Redis

Библиотека для кэширования данных в Redis.

## Пример использования

```ruby
require 'active_support/duration'
require_relative '../repositories/rubric_repository'
require 'cache-redis'
require 'redis'

class GetRubricsService
  def call
    cache = CacheRedis::Cache.new(redis)
    cache.fetch('rubrics', expire_in: 1.day) do
      rubrics = RubricRepository.new.all
      sort_rubrics(rubrics)
    end
  end

  private

  def redis
    @redis ||= Redis.new
  end
end
```

## Класс CacheRedis::Cache

### Методы объекта

#### `read(id)`

Возвращает данные по ключу, если они есть и валидные связанные с ними теги, или nil - если нет.

Обязательный параметр:

* _id_ - ключ.

#### `write(id, value, options = {})`

Сохраняет данные в кэш.

Обязательные параметры:

* _id_ - ключ.
* _value_ - данные, которые необходимо сохранить.

Необязательные параметры:

* _expire_in:_ - время жизни в секундах. Если не задано - используется значение по-умолчанию равное 5 минутам.
* _tags:_ - массив тегов, к которым нужно привязать ключ.

#### `fetch(id, options = {}, &_block)`

Метод объединяет чтение и запись данных в кэш.
Возвращает данные по ключу если данные есть. Если данных по ключу нет, то выполняет переданный блок, записывает результат выполнения блока в кэш и возвращает результат.

Обязательные параметры:

* _id_ - ключ.
* _&_block_ - блок, результат выполнения которого необходимо записать в кэш.

Необязательные параметры:

* _options_ - хэш опциональных параметров.
    * options[:expire_in] - время жизни кэша,
    * options[:tags] - массив тегов, к которым необходимо привязать ключ.


#### `delete(id)`

Удаляет сохраненные в кэше данные по ключу.

Обязательный параметр:

* _id_ - ключ.

#### `clean_by_tags(tags)`

Очищает кэш по переданному массиву тегов - обновляется время создания тегов и тем самым приводятся в негодность связанные с этими тегами ключи.

Обязательный параметр:

* _tags_ - массив тегов.
